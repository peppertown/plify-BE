<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Spotify Authorization</title>
  </head>
  <body>
    <h2>Spotify 로그인 테스트</h2>
    <button onclick="login()">Login with Spotify</button>

    <script>
      const clientId = 'c7c8540e012e4bf0b65953c7558591ec';
      const redirectUri = 'https://yeol.store';
      const scopes = [
        'user-read-email',
        'user-read-private',
        'user-top-read',
        'streaming',
        'user-read-playback-state',
        'user-modify-playback-state',
        'user-read-currently-playing',
        'ugc-image-upload',
        'playlist-read-private',
        'playlist-read-collaborative',
        'playlist-modify-private',
        'playlist-modify-public',
        'user-follow-modify',
        'user-follow-read',
        'user-read-playback-position',
        'user-read-recently-played',
        'user-library-read',
        'user-library-modify',
      ];

      function login() {
        const authUrl =
          `https://accounts.spotify.com/authorize?` +
          `client_id=${clientId}` +
          `&response_type=code` +
          `&redirect_uri=${encodeURIComponent(redirectUri)}` +
          `&scope=${encodeURIComponent(scopes.join(' '))}`;

        window.location.href = authUrl;
      }

      async function sendCodeToBackend(code) {
        try {
          const response = await fetch(
            'https://api.plify.store/auth/spotify/code',
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ code }),
            },
          );

          const data = await response.json();
          console.log('Backend response:', data);
          document.body.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        } catch (error) {
          console.error('Error sending code to backend:', error);
        }
      }

      window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        if (code) {
          sendCodeToBackend(code);
        }
      };
    </script>
  </body>
</html>
